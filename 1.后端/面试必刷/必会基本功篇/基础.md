[TOC]
# 1.网络基础
## 1.1.TCP协议
### 1.1.1.三次握手
- **过程**
1. 客户端——发送带有SYN标志的数据包——服务端 一次握手 Client进入syn_sent状态
2. 服务端——发送带有SYN/ACK标志的数据包——客户端 二次握手 服务端进入syn_rcvd
3. 客户端——发送带有ACK标志的数据包——服务端 三次握手 连接就进入Established状态
- **为什么三次?​**
	主要是为了建立可靠的通信信道，保证客户端与服务端同时具备发送、接收数据的能力

- **为什么两次不行？**
1. 防止已失效的请求报文又传送到了服务端，建立了多余的链接，浪费资源
2. 两次握手只能保证单向连接是畅通的。（为了实现可靠数据传输， TCP 协议的通信双方， 都必须维 护一个序列号， 以标识发送出去的数据包中， 哪些是已经被对方收到的。 三次握手的过程即是通信双方 相互告知序列号起始值， 并确认对方已经收到了序列号起始值的必经步骤；如果只是两次握手， 至多只有连接发起方的起始序列号能被确认， 另一方选择的序列号则得不到确认）

### 1.1.2.四次挥手
- **过程**
1. 客户端——发送带有FIN标志的数据包——服务端，关闭与服务端的连接 ，客户端进入FIN-WAIT-1状态
2. 服务端收到这个 FIN，它发回⼀ 个 ACK，确认序号为收到的序号加1，服务端就进入了CLOSE-WAIT状态
3. 服务端——发送⼀个FIN数据包——客户端，关闭与客户端的连接，客户端就进入FIN-WAIT-2状态
4. 客户端收到这个 FIN，发回 ACK 报⽂确认，并将确认序号设置为收到序号加1，TIME-WAIT状态

- **为什么四次？**
	因为需要确保客户端与服务端的数据能够完成传输。
	CLOSE-WAIT: 这种状态的含义其实是表示在等待关闭
	TIME-WAIT: 为了解决网络的丢包和网络不稳定所带来的其他问题，确保连接方能在时间范围内，关闭自己的连接

- **如何查看TIME-WAIT状态的链接数量？**
	netstat -an |grep TIME_WAIT|wc -l 查看连接数等待time_wait状态连接数

- **为什么会TIME-WAIT过多？解决方法是怎样的？**
	可能原因： 高并发短连接的TCP服务器上，当服务器处理完请求后立刻按照主动正常关闭连接
	​解决：负载均衡服务器；Web服务器首先关闭来自负载均衡服务器的连接
